!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("superagent"),require("lodash/memoize"),require("react")):"function"==typeof define&&define.amd?define(["exports","superagent","lodash/memoize","react"],t):t((e=e||self).restHook={},e.request,e._memoize,e.React)}(this,(function(e,t,r,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r;var i="default"in n?n.default:n;function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return(s="function"==typeof Symbol&&"symbol"===c(Symbol.iterator)?function(e){return c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":c(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?f(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(r,!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function b(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function k(e,t,r){var n=!0;return[Object.keys(e).reduce((function(t,i){var o=""+i,u=r(t.get(o),e[o]),a=u[0];return u[1]||(n=!1),t.has(o)?t.set(o,a):t}),t),n]}var w=function(e){return function(t){return b(t)?t.get(e):t[e]}},S=function(){function e(e,t,r){if(void 0===t&&(t={}),void 0===r&&(r={}),!e||"string"!=typeof e)throw new Error("Expected a string key for Entity, but found "+e+".");var n=r,i=n.idAttribute,o=void 0===i?"id":i,u=n.mergeStrategy,a=void 0===u?function(e,t){return m({},e,{},t)}:u,c=n.processStrategy,s=void 0===c?function(e){return m({},e)}:c;this._key=e,this._getId="function"==typeof o?o:w(o),this._idAttribute=o,this._mergeStrategy=a,this._processStrategy=s,this.define(t)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce((function(t,r){var n,i=e[r];return m({},t,((n={})[r]=i,n))}),this.schema||{})},t.getId=function(e,t,r){return this._getId(e,t,r)},t.merge=function(e,t){return this._mergeStrategy(e,t)},t.normalize=function(e,t,r,n,i,o){var u=this,a=this.getId(e,t,r),c=this.key;if(c in o||(o[c]={}),a in o[c]||(o[c][a]=[]),o[c][a].some((function(t){return t===e})))return a;o[c][a].push(e);var s=this._processStrategy(e,t,r);return Object.keys(this.schema).forEach((function(e){if(s.hasOwnProperty(e)&&"object"==typeof s[e]){var t=u.schema[e];s[e]=n(s[e],s,e,t,i,o)}})),i(this,s,e,t,r),a},t.denormalize=function(e,t){var r=this;if(b(e))return k(this.schema,e,t);var n=!0;return Object.keys(this.schema).forEach((function(i){var o=r.schema[i],u=t(e[i],o),a=u[0];u[1]||(n=!1),e.hasOwnProperty(i)&&(e[i]=a)})),[e,n]},a(e,[{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),e}(),O=function(){function e(e,t){t&&(this._schemaAttribute="string"==typeof t?function(e){return e[t]}:t),this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=e},t.getSchemaAttribute=function(e,t,r){return!this.isSingleSchema&&this._schemaAttribute(e,t,r)},t.inferSchema=function(e,t,r){if(this.isSingleSchema)return this.schema;var n=this.getSchemaAttribute(e,t,r);return this.schema[n]},t.normalizeValue=function(e,t,r,n,i,o){var u=this.inferSchema(e,t,r);if(!u)return e;var a=n(e,t,r,u,i,o);return this.isSingleSchema||null==a?a:{id:a,schema:this.getSchemaAttribute(e,t,r)}},t.denormalizeValue=function(e,t){var r=b(e)?e.get("schema"):e.schema;return this.isSingleSchema||r?t((b(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[r]):[e,!0]},a(e,[{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),e}(),j=function(e){function t(t,r){if(!r)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');return e.call(this,t,r)||this}g(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){return this.normalizeValue(e,t,r,n,i,o)},r.denormalize=function(e,t){return this.denormalizeValue(e,t)},t}(O),A=function(e){function t(){return e.apply(this,arguments)||this}g(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){var u=this;return Object.keys(e).reduce((function(t,r,a){var c,s=e[r];return null!=s?m({},t,((c={})[r]=u.normalizeValue(s,e,r,n,i,o),c)):t}),{})},r.denormalize=function(e,t){var r=this,n=!0;return[Object.keys(e).reduce((function(i,o){var u,a=e[o],c=r.denormalizeValue(a,t),s=c[0];return c[1]||(n=!1),m({},i,((u={})[o]=s,u))}),{}),n]},t}(O),E=function(e){if(Array.isArray(e)&&e.length>1)throw new Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]},P=function(e){return Array.isArray(e)?e:Object.keys(e).map((function(t){return e[t]}))},x=function(e,t,r,n,i,o,u){return e=E(e),P(t).map((function(t,a){return i(t,r,n,e,o,u)}))},_=function(e,t,r){e=E(e);var n=!0;void 0===t&&e&&(n=r(void 0,e)[1]);return[t&&t.map?t.map((function(t){return r(t,e)})).filter((function(e){return e[1]})).map((function(e){return e[0]})):t,n]},I=function(e){function t(){return e.apply(this,arguments)||this}g(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){var u=this;return P(e).map((function(e,a){return u.normalizeValue(e,t,r,n,i,o)})).filter((function(e){return null!=e}))},r.denormalize=function(e,t){var r=this,n=!0;void 0===e&&this.schema&&(n=t(void 0,this.schema)[1]);return[e&&e.map?e.map((function(e){return r.denormalizeValue(e,t)})).filter((function(e){return e[1]})).map((function(e){return e[0]})):e,n]},t}(O),q=function(e,t,r,n,i,o,u){var a=m({},t);return Object.keys(e).forEach((function(r){var n=e[r],c=i(t[r],t,r,n,o,u);null==c?delete a[r]:a[r]=c})),a},z=function(e,t,r){if(b(t))return k(e,t,r);var n=m({},t),i=!0;return Object.keys(e).forEach((function(t){var o=r(n[t],e[t]),u=o[0],a=o[1];null!=n[t]&&(n[t]=u),a||(i=!1)})),[n,i]},C=function e(t,r,n,i,o,u){return"object"==typeof t&&t?"object"!=typeof i||i.normalize&&"function"==typeof i.normalize?i.normalize(t,r,n,e,o,u):(Array.isArray(i)?x:q)(i,t,r,n,e,o,u):t},F={Array:I,Entity:S,Object:function(){function e(e){this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce((function(t,r){var n,i=e[r];return m({},t,((n={})[r]=i,n))}),this.schema||{})},t.normalize=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return q.apply(void 0,[this.schema].concat(t))},t.denormalize=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return z.apply(void 0,[this.schema].concat(t))},e}(),Union:j,Values:A},R=function(e,t){if(!e||"object"!=typeof e)throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+(null===e?"null":typeof e)+'".');var r={},n=function(e){return function(t,r,n,i,o){var u=t.key,a=t.getId(n,i,o);u in e||(e[u]={});var c=e[u][a];e[u][a]=c?t.merge(c,r):r}}(r);return{entities:r,result:C(e,e,null,t,n,{})}},M=function(e){var t={},r=D(e);return function e(n,i){return"object"!=typeof i||i.denormalize&&"function"==typeof i.denormalize?null===n?[n,!0]:i instanceof S?void 0===n?[n,!1]:function(e,t,r,n,i){var o=n(e,t);if("object"!=typeof o||null===o)return[o,!1];i[t.key]||(i[t.key]={});var u=!0;if(!i[t.key][e]){var a=b(o)?o:m({},o);i[t.key][e]=a;var c=t.denormalize(a,r);i[t.key][e]=c[0],u=c[1]}return[i[t.key][e],u]}(n,i,e,r,t):"function"==typeof i.denormalize?i.denormalize(n,e):[n,!0]:(Array.isArray(i)?_:z)(i,n,e)}},D=function(e){var t=b(e);return function(r,n){var i=n.key;return"object"==typeof r?r:t?e.getIn([i,r.toString()]):e[i]&&e[i][r]}},K=function(e,t,r){return void 0!==e?M(r)(e,t):[void 0,!1]},U=Symbol("Defined Members"),L=function(){function e(){o(this,e),v(this,"__url",void 0)}return a(e,[{key:"url",get:function(){return void 0!==this.__url?this.__url:this.constructor.url(this)}}],[{key:"fromJS",value:function(e){var t=new this(e);if(void 0===t.pk)throw new Error("cannot construct on abstract types");return Object.defineProperty(t,U,{value:Object.keys(e),writable:!1}),Object.assign(t,e),Object.defineProperty(t,"__ownerID",{value:1337,writable:!1}),t}},{key:"merge",value:function(e,t){var r=Object.assign({},this.toObjectDefined(e),this.toObjectDefined(t));return this.fromJS(r)}},{key:"hasDefined",value:function(e,t){return e[U].includes(t)}},{key:"toObjectDefined",value:function(e){var t={},r=!0,n=!1,i=void 0;try{for(var o,u=e[U][Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var a=o.value;t[a]=e[a]}}catch(e){n=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(n)throw i}}return t}},{key:"keysDefined",value:function(e){return e[U]}},{key:"toString",value:function(){return"".concat(this.name,"::").concat(this.urlRoot)}},{key:"getKey",value:function(){return this.urlRoot}},{key:"pk",value:function(e){return this.prototype.pk.call(e)}},{key:"url",value:function(e){if(e){if(Object.prototype.hasOwnProperty.call(e,"url")&&e.url&&"string"==typeof e.url)return e.url;if(null!==this.pk(e))return this.urlRoot.endsWith("/")?"".concat(this.urlRoot).concat(this.pk(e)):"".concat(this.urlRoot,"/").concat(this.pk(e))}return this.urlRoot}},{key:"listUrl",value:function(e){if(e&&Object.keys(e).length){var t=new URLSearchParams(e);return t.sort(),"".concat(this.urlRoot,"?").concat(t.toString())}return this.urlRoot}},{key:"fetch",value:function(e,t,r){throw new Error("not implemented")}},{key:"getEntitySchema",value:function(){return T(this)}},{key:"getFetchOptions",value:function(){}},{key:"detailShape",value:function(){var e=this;return{type:"read",schema:this.getEntitySchema(),options:this.getFetchOptions(),getFetchKey:function(t){return"GET "+e.url(t)},fetch:function(t){return e.fetch("get",e.url(t))}}}},{key:"listShape",value:function(){var e=this;return{type:"read",schema:[this.getEntitySchema()],options:this.getFetchOptions(),getFetchKey:function(t){return"GET "+e.listUrl(t)},fetch:function(t){return e.fetch("get",e.listUrl(t))}}}},{key:"createShape",value:function(){var e=this,t=this.getFetchOptions();return{type:"mutate",schema:this.getEntitySchema(),options:t,getFetchKey:function(t){return"POST "+e.listUrl(t)},fetch:function(t,r){return e.fetch("post",e.listUrl(t),r)}}}},{key:"updateShape",value:function(){var e=this,t=this.getFetchOptions();return{type:"mutate",schema:this.getEntitySchema(),options:t,getFetchKey:function(t){return"PUT "+e.url(t)},fetch:function(t,r){return e.fetch("put",e.url(t),r)}}}},{key:"partialUpdateShape",value:function(){var e=this,t=this.getFetchOptions();return{type:"mutate",schema:this.getEntitySchema(),options:t,getFetchKey:function(t){return"PATCH "+e.url(t)},fetch:function(t,r){return e.fetch("patch",e.url(t),r)}}}},{key:"deleteShape",value:function(){var e=this,t=this.getFetchOptions();return{type:"delete",schema:this.getEntitySchema(),options:t,getFetchKey:function(t){return"DELETE "+e.url(t)},fetch:function(t){return e.fetch("delete",e.url(t))}}}}]),e}();v(L,"urlRoot",void 0),Object.defineProperty(L.prototype,"url",{set:function(e){this.__url=e}});var T=r((function(e){var t=new F.Entity(e.getKey(),{},{idAttribute:function(t,r,n){return(e.pk(t)||n).toString()},processStrategy:function(t){return e.fromJS(t)},mergeStrategy:function(e,t){return e.constructor.merge(e,t)}});return t.denormalize=function(e){return[e,!0]},t})),H=function(e){function r(){return o(this,r),l(this,h(r).apply(this,arguments))}return p(r,e),a(r,null,[{key:"fetch",value:function(e,r,n){var i=t[e](r).on("error",(function(){}));return this.fetchPlugin&&(i=i.use(this.fetchPlugin)),n&&(i=i.send(n)),i.then((function(e){if(V(e))throw new Error("JSON expected but not returned from API");return e.body}))}}]),r}(L);v(H,"fetchPlugin",void 0);var V=function(e){var t=""===e.text&&204===e.status,r=0===Object.keys(e.body).length;return!(e.type.includes("json")||t)&&r};function N(e){return void 0!==e.key}var J=H,$="function"==typeof global.requestIdleCallback?global.requestIdleCallback:function(e){return global.setTimeout(e,0)},G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;o(this,e),v(this,"fetched",{}),v(this,"resolvers",{}),v(this,"rejectors",{}),v(this,"dataExpiryLength",void 0),v(this,"errorExpiryLength",void 0),v(this,"getMiddleware",r((function(){var e=this;return function(t){var r=t.dispatch;return function(t){return function(n){switch(n.type){case"rest-hooks/fetch":return e.handleFetch(n,r),Promise.resolve();case"rest-hooks/purge":case"rest-hooks/rpc":case"rest-hooks/receive":return t(n).then((function(){n.meta.url in e.fetched&&e.handleReceive(n)}));case"rest-hooks/reset":return e.cleanup(),t(n);default:return t(n)}}}}}))),this.dataExpiryLength=t,this.errorExpiryLength=n}return a(e,[{key:"cleanup",value:function(){for(var e in this.rejectors){var t=new Error("Cleaning up Network Manager");t.name="CLEANUP",this.rejectors[e](t)}}},{key:"clear",value:function(e){delete this.resolvers[e],delete this.rejectors[e],delete this.fetched[e]}},{key:"handleFetch",value:function(e,t){var r,n=e.payload,i=e.meta,o=i.schema,u=i.url,a=i.responseType,c=i.throttle,s=i.resolve,f=i.updaters,l=i.reject,h=i.options,y=void 0===h?{}:h,p=y.dataExpiryLength,v=void 0===p?this.dataExpiryLength:p,d=y.errorExpiryLength,m=void 0===d?this.errorExpiryLength:d,g=function(){return n().then((function(e){var r=Date.now(),n={schema:o,url:u,date:r,expiresAt:r+v};return["rest-hooks/receive","rest-hooks/rpc"].includes(a)&&(n.updaters=f),t({type:a,payload:e,meta:n}),e})).catch((function(e){if("CLEANUP"!==e.name){var r=Date.now();throw t({type:a,payload:e,meta:{schema:o,url:u,date:r,expiresAt:r+m},error:!0}),e}}))};return(r=c?this.throttle(u,g):g()).then((function(e){return s(e)})).catch((function(e){return l(e)})),r}},{key:"handleReceive",value:function(e){e.meta.url in this.fetched&&((e.error?this.rejectors[e.meta.url]:this.resolvers[e.meta.url])(e.payload),this.clear(e.meta.url))}},{key:"throttle",value:function(e,t){var r=this;return e in this.fetched?this.fetched[e]:(this.fetched[e]=new Promise((function(t,n){r.resolvers[e]=t,r.rejectors[e]=n})),$((function(){t().catch((function(){return null}))}),{timeout:500}),this.fetched[e])}}]),e}();function B(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var W=function(){function e(t,r){var n=t.url,i=t.schema,u=t.fetch,a=t.frequency;if(o(this,e),v(this,"schema",void 0),v(this,"fetch",void 0),v(this,"url",void 0),v(this,"frequency",void 0),v(this,"frequencyHistogram",new Map),v(this,"dispatch",void 0),v(this,"intervalId",void 0),v(this,"lastIntervalId",void 0),void 0===a)throw new Error("frequency needed for polling subscription");this.schema=i,this.fetch=u,this.frequency=a,this.url=n,this.frequencyHistogram.set(this.frequency,1),this.dispatch=r,this.run()}return a(e,[{key:"add",value:function(e){void 0!==e&&(this.frequencyHistogram.has(e)?this.frequencyHistogram.set(e,this.frequencyHistogram.get(e)+1):(this.frequencyHistogram.set(e,1),e<this.frequency&&(this.frequency=e,this.run())))}},{key:"remove",value:function(e){if(void 0===e)return!1;if(this.frequencyHistogram.has(e)&&(this.frequencyHistogram.set(e,this.frequencyHistogram.get(e)-1),this.frequencyHistogram.get(e)<1)){if(this.frequencyHistogram.delete(e),0===this.frequencyHistogram.size)return this.cleanup(),!0;e<=this.frequency&&(this.frequency=Math.min.apply(Math,B(this.frequencyHistogram.keys())),this.run())}return!1}},{key:"cleanup",value:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0),this.lastIntervalId&&(clearInterval(this.lastIntervalId),this.lastIntervalId=void 0)}},{key:"update",value:function(){this.dispatch({type:"rest-hooks/fetch",payload:this.fetch,meta:{schema:this.schema,url:this.url,responseType:"rest-hooks/receive",throttle:!0,options:{dataExpiryLength:this.frequency/2,errorExpiryLength:this.frequency/10},resolve:function(){},reject:function(){}}})}},{key:"run",value:function(){var e=this;this.lastIntervalId=this.intervalId,this.intervalId=setInterval((function(){e.lastIntervalId&&(clearInterval(e.lastIntervalId),e.lastIntervalId=void 0),e.update()}),this.frequency)}}]),e}(),Q=function(){function e(t){o(this,e),v(this,"subscriptions",{}),v(this,"Subscription",void 0),this.Subscription=t,this.getMiddleware=r(this.getMiddleware)}return a(e,[{key:"cleanup",value:function(){for(var e in this.subscriptions)this.subscriptions[e].cleanup()}},{key:"handleSubscribe",value:function(e,t){var r=e.meta.url;r in this.subscriptions?this.subscriptions[r].add(e.meta.frequency):this.subscriptions[r]=new this.Subscription({schema:e.meta.schema,fetch:e.meta.fetch,frequency:e.meta.frequency,url:r},t)}},{key:"handleUnsubscribe",value:function(e,t){var r=e.meta.url;r in this.subscriptions&&(this.subscriptions[r].remove(e.meta.frequency)&&delete this.subscriptions[r])}},{key:"getMiddleware",value:function(){var e=this;return function(t){var r=t.dispatch;return function(t){return function(n){switch(n.type){case"rest-hooks/subscribe":return e.handleSubscribe(n,r),Promise.resolve();case"rest-hooks/unsubscribe":return e.handleUnsubscribe(n,r),Promise.resolve();default:return t(n)}}}}}}]),e}();function X(e){return function(e){return!!e&&"object"===s(e)}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===Y}(e)}(e)}var Y="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function Z(e,t){var r=Array.isArray(t),n=Array.isArray(e),i=r===n,o=t&&t.constructor;if(e&&o&&ee(o))return ee(e.constructor)?o.merge(e,t):t;if(X(t)){if(X(e)&&i){var u=n?B(e):m({},e);return Object.keys(t).forEach((function(e){u[e]=Z(u[e],t[e])})),u}return Z(r?[]:{},t)}return void 0===t?e:t}function ee(e){return e&&"function"==typeof e.merge}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function re(e,t,r){return r?m({},e,{},Object.fromEntries(Object.entries(r).map((function(r){var n=te(r,2),i=n[0];return[i,(0,n[1])(t,e[i])]})))):e}var ne,ie={entities:{},results:{},meta:{}};function oe(e,t){switch(e||(e=ie),t.type){case"rest-hooks/receive":if(t.error)return m({},e,{meta:m({},e.meta,v({},t.meta.url,{date:t.meta.date,error:t.payload,expiresAt:t.meta.expiresAt}))});var r=R(t.payload,t.meta.schema),n=r.result,i=r.entities,o=m({},e.results,v({},t.meta.url,n));return o=re(o,n,t.meta.updaters),{entities:Z(e.entities,i),results:o,meta:m({},e.meta,v({},t.meta.url,{date:t.meta.date,expiresAt:t.meta.expiresAt}))};case"rest-hooks/rpc":if(t.error)return e;var u=R(t.payload,t.meta.schema),a=u.entities,c=u.result,s=re(e.results,c,t.meta.updaters);return m({},e,{entities:Z(e.entities,a),results:s});case"rest-hooks/purge":if(t.error)return e;var f=t.meta.schema.key,l=t.meta.url,h=function(e,t,r){var n=m({},e);return n[t]=m({},n[t]),delete n[t][r],n}(e.entities,f,l);return m({},e,{entities:h});case"rest-hooks/invalidate":return m({},e,{meta:m({},e.meta,v({},t.meta.url,m({},e.meta[t.meta.url],{expiresAt:0})))});case"rest-hooks/reset":return ie;default:return e}}function ue(e){if(N(e)||e instanceof F.Array||Array.isArray(e))return[];var t=e instanceof F.Object?e.schema:e;for(var r in t)if(t[r]){var n=ue(t[r]);if(!1!==n)return n.unshift(r),n}return!1}function ae(e,t){if(N(e)){var r=e.getId(t,void 0,"");return void 0===r||""===r?null:r}if(e instanceof F.Array||Array.isArray(e)||e instanceof F.Values)return null;if(e instanceof F.Union){var n=e.inferSchema(t,void 0,"");return void 0===n?null:{id:ae(n,t),schema:e.getSchemaAttribute(t,parent,"")}}var i,o=e instanceof F.Object?e.schema:e,u={};for(var a in o)if("object"!==s(i=o[a])||null===i)u[a]=o[a];else{var c=ae(o[a],t);if(!c)return null;u[a]=c}return u}function ce(e,t,r){var i=e.schema,o=e.getFetchKey,u=function(e,t,r){var i=e.schema,o=e.getFetchKey,u=r.entities,a=t&&r.results[o(t)],c=n.useMemo((function(){return t?a||ae(i,t):null}),[a,t&&o(t)]);return n.useMemo((function(){if(!u||!t||!c)return null;var e=te(K(c,i,u),2),r=e[0];return e[1]||a?r:null}),[u,t&&o(t),c])}({schema:i,getFetchKey:o},t,r),a=n.useMemo((function(){return function(e){var t=ue(e);if(!1===t)throw new Error("Schema invalid - no path to entity found");return 0===t.length?null:function(e){var r=e,n=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(n=(u=a.next()).done);n=!0){r=r[u.value]}}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}}(i)}),[]),c=n.useMemo((function(){return a&&u?a(u):u}),[u,a]);return void 0===c?null:c}function se(e,t){if(N(e)){if(!t)return;var r=e.getId(t,void 0,"");if(void 0===r||""===r)return;return r}if(e instanceof F.Union){var n=e.inferSchema(t,void 0,"");if(void 0===n)return;return{id:se(n,t),schema:e.getSchemaAttribute(t,parent,"")}}if(!(e instanceof F.Array||Array.isArray(e))){if(e instanceof F.Values)return{};var i,o=e instanceof F.Object?e.schema:e,u={};for(var a in o)"object"!==s(i=o[a])||null==i?u[a]=o[a]:u[a]=se(o[a],t);return u}}function fe(e,t,r){var i=e.schema,o=e.getFetchKey,u=r.entities,a=t&&r.results[o(t)],c=n.useMemo((function(){return a||se(i,t)}),[a,t&&o(t)]);return n.useMemo((function(){var e=te(K(c,i,u),2);return[e[0],e[1]]}),[u,t&&o(t),c])}function le(e,t,r,n){ne||(ne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=n;else if(o>1){for(var u=new Array(o),a=0;a<o;a++)u[a]=arguments[a+3];t.children=u}if(t&&i)for(var c in i)void 0===t[c]&&(t[c]=i[c]);else t||(t=i||{});return{$$typeof:ne,type:e,key:void 0===r?null:""+r,ref:null,props:t,_owner:null}}var he=function(e){function t(){var e,r;o(this,t);for(var n=arguments.length,i=new Array(n),u=0;u<n;u++)i[u]=arguments[u];return v(f(r=l(this,(e=h(t)).call.apply(e,[this].concat(i)))),"state",{}),r}return p(t,e),a(t,[{key:"render",value:function(){return this.state.error?le(this.props.fallbackComponent,{error:this.state.error}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"status")}(e))return{error:e}}}]),t}(i.Component);v(he,"defaultProps",{fallbackComponent:function(e){var t=e.error;return le("div",{},void 0,t.status," ",t.response&&t.response.statusText)}});var ye=i.createContext(ie),pe=i.createContext((function(e){return Promise.resolve()}));function ve(e,t){var r=n.useRef(null);return n.useEffect((function(){r.current&&(r.current.resolve(),r.current=null)}),[t]),n.useCallback((function(t){var n;r.current||(r.current=((n={}).promise=new Promise((function(e){n.resolve=e})),n));var i=r.current.promise;return e(t),i}),[e])}function de(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r){var i=n.useRef(r),o=te(n.useReducer(e,r),2),u=o[0],a=o[1];n.useEffect((function(){i.current=u}),[u]);var c=ve(a,u),s=n.useMemo((function(){var e=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},r={getState:function(){return i.current},dispatch:function(t){return e(t)}},n=t.map((function(e){return e(r)}));return e=me(n)(c)}),[c]);return[u,s]}}var me=function(e){return function(t){return e.reduceRight((function(e,t){return t(e)}),t)}};function ge(e){var t=e.children,r=e.managers,i=e.initialState,o=te(de.apply(void 0,B(r.map((function(e){return e.getMiddleware()}))))(oe,i),2),u=o[0],a=o[1];return n.useEffect((function(){return function(){for(var e=0;e<r.length;++e)r[e].cleanup()}}),r),le(pe.Provider,{value:a},void 0,le(ye.Provider,{value:u},void 0,t))}ge.defaultProps={managers:[new G,new Q(W)],initialState:ie};var be={read:"rest-hooks/receive",mutate:"rest-hooks/rpc",delete:"rest-hooks/purge"};function ke(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n.useContext(pe),i=n.useRef(e);return i.current=e,n.useCallback((function(e,n,o){var u=i.current,a=u.fetch,c=u.schema,s=u.type,f=u.getFetchKey,l=u.options,h=be[s],y=f(e),p="delete"===i.current.type?i.current.schema.getId(e):y,d=0,g=0,b=new Promise((function(e,t){d=e,g=t})),k={schema:c,responseType:h,url:p,throttle:t,options:l,resolve:d,reject:g};return o&&(k.updaters=o.reduce((function(e,t){var r=te(t,3),n=r[0],i=r[1],o=r[2];return m(v({},n.getFetchKey(i),o),e)}),{})),r({type:"rest-hooks/fetch",payload:function(){return a(e,n)},meta:k}),b}),[r,t])}function we(e,t){return ce(e,t,n.useContext(ye))}function Se(e,t){var r=e.getFetchKey,i=n.useContext(ye),o=t?r(t):"";return n.useMemo((function(){return o?function(e,t){return e.meta[t]}(i,o):null}),[o,i])}function Oe(e,t){var r=ke(e,!0),i=function(e,t){var r=Se(e,t);return r?r.expiresAt:0}(e,t);return n.useMemo((function(){if(!(Date.now()<=i)&&t)return r(t)}),[i,r,t&&e.getFetchKey(t)])}function je(e,t,r){var n=Se(e,t);if(t&&!r){if(!n)return;if(n.error)return n.error;var i=new Error("Resource not found in cache ".concat(t?e.getFetchKey(t):""));return i.status=404,i}}function Ae(e,t){return!(t.options&&t.options.invalidIfStale||!e)}function Ee(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var i=n.useContext(ye),o=t.map((function(e){var t=te(e,2);return(fe(t[0],t[1],i))})),u=t.map((function(e){var t=te(e,2);return(Oe(t[0],t[1]))})).map((function(e,r){return!Ae(o[r][1],t[r][0])&&e})),a=0;a<t.length;a++){var c=te(t[a],2),s=c[0],f=c[1],l=te(o[a],2),h=(l[0],je(s,f,l[1]));if(h&&!u[a])throw h}var y=n.useMemo((function(){var e=u.filter((function(e){return e}));if(e.length)return Promise.all(e)}),u);if(y)throw y;return o.map((function(e){return te(e,1)[0]}))}function Pe(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var i=t.map((function(e){var t=te(e,2);return(we(t[0],t[1]))})),o=t.map((function(e){var t=te(e,2);return(Oe(t[0],t[1]))})).map((function(e,r){return!Ae(!!i[r],t[r][0])&&e})),u=0;u<t.length;u++){var a=te(t[u],2),c=je(a[0],a[1],!!i[u]);if(c&&!o[u])throw c}var s=n.useMemo((function(){var e=o.filter((function(e){return e}));if(e.length)return Promise.all(e)}),o);if(s)throw s;return i}var xe={initialState:ie,StateContext:ye,DispatchContext:pe,RIC:$};e.CacheProvider=ge,e.ExternalCacheProvider=function(e){var t=e.children,r=e.store,i=e.selector,o=te(n.useState((function(){return i(r.getState())})),2),u=o[0],a=o[1];n.useEffect((function(){return r.subscribe((function(){a(i(r.getState()))}))}),[r]);var c=ve(r.dispatch,u);return le(pe.Provider,{value:c},void 0,le(ye.Provider,{value:u},void 0,t))},e.NetworkErrorBoundary=he,e.NetworkManager=G,e.PollingSubscription=W,e.PromiseifyMiddleware=function(e){return function(e){return function(t){return e(t),Promise.resolve()}}},e.Resource=H,e.SimpleResource=L,e.SubscriptionManager=Q,e.SuperagentResource=J,e.__INTERNAL__=xe,e.reducer=oe,e.schemas=F,e.useCache=function(e,t){return fe(e,t,n.useContext(ye))[0]},e.useCacheLegacy=we,e.useDenormalized=fe,e.useError=je,e.useFetcher=ke,e.useInvalidator=function(e){var t=n.useContext(pe),r=n.useRef(e.getFetchKey);return r.current=e.getFetchKey,n.useCallback((function(e){e&&t({type:"rest-hooks/invalidate",meta:{url:r.current(e)}})}),[t])},e.useMeta=Se,e.useResetter=function(){var e=n.useContext(pe);return n.useCallback((function(){e({type:"rest-hooks/reset"})}),[e])},e.useResource=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Array.isArray(t[0])?Ee.apply(void 0,B(t)):function(e,t){var r=Oe(e,t),i=te(fe(e,t,n.useContext(ye)),2),o=i[0],u=i[1],a=je(e,t,u);if(!Ae(u,e)&&r)throw r;if(a)throw a;return o}((t=t)[0],t[1])},e.useResourceLegacy=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Array.isArray(t[0])?Pe.apply(void 0,B(t)):function(e,t){var r=Oe(e,t),n=we(e,t),i=je(e,t,!!n);if(!Ae(!!n,e)&&r)throw r;if(i)throw i;return n}((t=t)[0],t[1])},e.useRetrieve=Oe,e.useSelectionUnstable=function(e,t,r){var i=n.useContext(ye);return n.useMemo((function(){return t&&e(i,t)}),[t&&r(t),e,i])},e.useSubscription=function(e,t){var r=n.useContext(pe),i=n.useRef(e);i.current=e,n.useEffect((function(){if(t){var e=i.current,n=e.fetch,o=e.schema,u=e.getFetchKey,a=e.options,c=u(t);return r({type:"rest-hooks/subscribe",meta:{schema:o,fetch:function(){return n(t)},url:c,frequency:a&&a.pollFrequency}}),function(){r({type:"rest-hooks/unsubscribe",meta:{url:c,frequency:a&&a.pollFrequency}})}}}),[r,t&&e.getFetchKey(t)])},Object.defineProperty(e,"__esModule",{value:!0})}));
